<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Premium Shop âœ¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }
        body {
            background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .signup-container {
            max-width: 400px;
            margin: 50px auto;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            text-align: center;
            transition: transform 0.3s;
        }
        .signup-container:hover {
            transform: translateY(-5px);
        }
        .signup-container h2 {
            color: #2c3e50;
            margin-bottom: 20px;
        }
        .signup-container button {
            width: 100%;
            padding: 12px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: background 0.3s, transform 0.2s;
        }
        .signup-container button:hover {
            background: #2980b9;
            transform: scale(1.05);
        }
        #dashboard {
            display: none;
        }
        .navbar {
            background: linear-gradient(90deg, #2c3e50, #34495e);
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        .navbar h2 {
            color: white;
            text-align: center;
            font-size: 1.8em;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .navbar h2 img {
            width: 40px;
            height: 40px;
            margin-right: 10px;
        }
        .navbar button {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            transition: background 0.3s;
        }
        .navbar button:hover {
            background: #c0392b;
        }
        .content {
            padding: 20px 0;
        }
        .bottom-nav {
            position: fixed;
            bottom: 0;
            width: 100%;
            background: #2c3e50;
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
        }
        .bottom-nav .nav-item {
            text-align: center;
            color: white;
            cursor: pointer;
            padding: 5px;
            transition: transform 0.3s;
        }
        .bottom-nav .nav-item:hover {
            transform: scale(1.1);
        }
        .bottom-nav .nav-item img {
            width: 30px;
            height: 30px;
            margin-bottom: 5px;
        }
        .bottom-nav .nav-item p {
            font-size: 0.9em;
        }
        .section {
            display: none;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        .post-card {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: transform 0.3s;
        }
        .post-card:hover {
            transform: translateY(-5px);
        }
        .post-card img, .post-card video, .post-card audio {
            max-width: 100%;
            border-radius: 10px;
            margin-top: 10px;
        }
        .premium-option {
            background: #3498db;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: transform 0.3s, background 0.3s;
        }
        .premium-option:hover {
            transform: scale(1.05);
            background: #2980b9;
        }
        .quantity {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 10px 0;
        }
        .quantity button {
            background: #3498db;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            margin: 0 5px;
        }
        #totalPrice {
            text-align: center;
            font-size: 1.2em;
            margin: 10px 0;
        }
        .payment-method select, .payment-method input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        #status {
            text-align: center;
            margin-top: 10px;
            color: #2ecc71;
        }
    </style>
</head>
<body>
    <div id="loginSection" class="signup-container">
        <h2>Anonymous Login</h2>
        <button id="loginButton" onclick="anonymousLogin()">Login</button>
    </div>

    <div id="dashboard">
        <div class="navbar">
            <h2><img src="https://raw.githubusercontent.com/Opper125/telegram-premium-shop/main/telegram-logo.png" alt="Logo"> Telegram Premium Shop</h2>
            <button id="logoutButton" onclick="logout()">Logout</button>
        </div>
        <div class="container">
            <div id="homeSection" class="section">
                <h2>Home</h2>
                <a href="/post.html" target="_blank">Create a Post</a>
                <div id="posts"></div>
            </div>
            <div id="shopSection" class="section">
                <h2>Shop</h2>
                <div class="premium-option" onclick="selectPremium(3, 60000)">
                    Premium 3 Months - 60,000 MMK
                </div>
                <div class="premium-option" onclick="selectPremium(6, 135000)">
                    Premium 6 Months - 135,000 MMK
                </div>
                <div class="premium-option" onclick="selectPremium(12, 210000)">
                    Premium 1 Year - 210,000 MMK
                </div>
                <div class="quantity">
                    <button onclick="decreaseQuantity()">-</button>
                    <span id="quantity">1</span>
                    <button onclick="increaseQuantity()">+</button>
                </div>
                <div id="totalPrice">Total: 60,000 MMK</div>
                <div class="payment-method">
                    <select id="paymentSelect" onchange="showPhoneNumber()">
                        <option value="">Select Payment Method</option>
                        <option value="kpay">Kpay</option>
                        <option value="wave">Wave</option>
                    </select>
                </div>
                <input type="text" id="transactionId" placeholder="Enter Transaction ID" required>
                <input type="text" id="telegramUsername" placeholder="Enter Telegram Username" required>
                <button onclick="submitOrder()">Submit Order</button>
                <div id="status">Wait Admin Check <audio id="waitAudio" src="https://raw.githubusercontent.com/Opper125/telegram-premium-shop/main/wait_admin_check.mp3" preload="auto"></audio></div>
            </div>
            <div id="hostSection" class="section">
                <h2>Host</h2>
                <p>Host your events or join as a host!</p>
            </div>
            <div id="profileSection" class="section">
                <h2>Profile</h2>
                <p>User ID: <span id="userIdDisplay"></span></p>
                <p>Phone: N/A (Anonymous)</p>
            </div>
            <div id="meSection" class="section">
                <h2>Me</h2>
                <p>Manage your account settings here.</p>
            </div>
        </div>
        <div class="bottom-nav">
            <div class="nav-item" onclick="showSection('homeSection')">
                <img src="https://raw.githubusercontent.com/Opper125/telegram-premium-shop/main/home-icon.png" alt="Home">
                <p>Home</p>
            </div>
            <div class="nav-item" onclick="showSection('shopSection')">
                <img src="https://raw.githubusercontent.com/Opper125/telegram-premium-shop/main/shop-icon.png" alt="Shop">
                <p>Shop</p>
            </div>
            <div class="nav-item" onclick="showSection('hostSection')">
                <img src="https://raw.githubusercontent.com/Opper125/telegram-premium-shop/main/host-icon.png" alt="Host">
                <p>Host</p>
            </div>
            <div class="nav-item" onclick="showSection('profileSection')">
                <img src="https://raw.githubusercontent.com/Opper125/telegram-premium-shop/main/profile-icon.png" alt="Profile">
                <p>Profile</p>
            </div>
            <div class="nav-item" onclick="showSection('meSection')">
                <img src="https://raw.githubusercontent.com/Opper125/telegram-premium-shop/main/me-icon.png" alt="Me">
                <p>Me</p>
            </div>
        </div>
    </div>

    <script>
        let selectedMonths = 3;
        let selectedPrice = 60000;
        let quantity = 1;
        let userId = localStorage.getItem('userId');

        if (!userId) {
            document.getElementById('loginSection').style.display = 'block';
            document.getElementById('dashboard').style.display = 'none';
        } else {
            document.getElementById('dashboard').style.display = 'block';
            showSection('homeSection');
            loadPosts();
            setupRealTimePosts();
            document.getElementById('userIdDisplay').innerText = userId;
        }

        function anonymousLogin() {
            userId = 'anon-' + Math.random().toString(36).substr(2, 9);
            localStorage.setItem('userId', userId);
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            showSection('homeSection');
            loadPosts();
            setupRealTimePosts();
            document.getElementById('userIdDisplay').innerText = userId;
        }

        function logout() {
            localStorage.removeItem('userId');
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('loginSection').style.display = 'block';
        }

        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => section.style.display = 'none');
            document.getElementById(sectionId).style.display = 'block';
            if (sectionId === 'homeSection') {
                loadPosts();
            }
        }

        // Post-related functions
        async function loadPosts() {
            try {
                const response = await fetch('/.netlify/functions/get-posts');
                const posts = await response.json();
                const postsDiv = document.getElementById('posts');
                postsDiv.innerHTML = posts.map(post => `
                    <div class="post-card">
                        <p><strong>${post.userId}</strong> - ${new Date(post.timestamp).toLocaleString()}</p>
                        <p>${post.content || 'No content'}</p>
                        ${post.photo ? `<img src="${post.photo}" alt="Post Photo">` : ''}
                        ${post.video ? `<video src="${post.video}" controls></video>` : ''}
                        ${post.audio ? `<audio src="${post.audio}" controls></audio>` : ''}
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading posts:', error);
                document.getElementById('posts').innerHTML = '<p>Error loading posts. Please try again later.</p>';
            }
        }

        function setupRealTimePosts() {
            const eventSource = new EventSource('/.netlify/functions/posts-stream');
            eventSource.onmessage = (event) => {
                try {
                    loadPosts();
                } catch (error) {
                    console.error('Error parsing SSE data:', error);
                }
            };
            eventSource.onerror = (error) => {
                console.error('SSE Error:', error);
                eventSource.close();
                setTimeout(setupRealTimePosts, 5000);
            };
        }

        // Shop-related functions
        function selectPremium(months, price) {
            selectedMonths = months;
            selectedPrice = price;
            updateTotal();
        }

        function increaseQuantity() { quantity++; updateTotal(); }
        function decreaseQuantity() { if (quantity > 1) quantity--; updateTotal(); }
        function updateTotal() { document.getElementById('quantity').innerText = quantity; document.getElementById('totalPrice').innerText = `Total: ${selectedPrice * quantity} MMK`; }
        function showPhoneNumber() { /* Same as original */ }

        async function submitOrder() {
            const order = {
                userId,
                phoneNumber: 'N/A (Anonymous)',
                months: selectedMonths,
                quantity,
                total: selectedPrice * quantity,
                transactionId: document.getElementById('transactionId').value,
                telegramUsername: document.getElementById('telegramUsername').value,
                paymentMethod: document.getElementById('paymentSelect').value,
                status: 'approved', // Auto-approve for anonymous
                timestamp: new Date().toISOString()
            };
            try {
                const response = await fetch('/.netlify/functions/submit-order', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(order)
                });
                const result = await response.json();
                document.getElementById('status').innerText = 'Order submitted and approved!';
                fetch('https://opeer-telegram-good.netlify.app/.netlify/functions/update-orders', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(order)
                });
            } catch (error) {
                document.getElementById('status').innerText = 'Error submitting order.';
            }
        }
    </script>
</body>
</html>
